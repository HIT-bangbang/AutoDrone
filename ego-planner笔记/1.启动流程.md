# 操作流程
* 自动起飞：

```sh
sh shfiles/rspx4.sh
rostopic echo /vins_fusion/imu_propagate
```
拿起飞机进行缓慢的小范围晃动，放回原地后确认没有太大误差。遥控器5通道打到低位（`CMD_CTRL` 模式），6通道拨到低位，油门打到中位

```sh
roslaunch px4ctrl run_ctrl.launch
sh shfiles/takeoff.sh
```

* Ego-Planner实验:
```sh
roslaunch ego_planner single_run_in_exp.launch
sh shfiles/record.sh
roslaunch ego_planner rviz.launch
```

# 启动文件

以上主要有五个文件，包括 `rspx4.sh`  `run_ctrl.launch` `single_run_in_exp.launch` `takeoff.sh`  `rviz.launch`

这五个文件依次启动的过程中，大致经历了以下流程：

## `rspx4.sh`

```sh
chmod 777 /dev/ttyACM0		#给px4串口777权限
roslaunch realsense2_camera rs_camera.launch #打开realsense相机
roslaunch mavros px4.launch	#运行px4的mavros节点，建立通信
roslaunch vins fast_drone_250.launch	# 启动VINS
```

## `takeoff.sh`
```sh
# 自动起飞
rostopic pub -1  /px4ctrl/takeoff_land quadrotor_msgs/TakeoffLand "takeoff_land_cmd: 1" 
# 向 takeoff_land 话题发布数据：takeoff_land_cmd:1 
# px4.ctrl 节点订阅到这个数据会跳转到自动起飞状态
```

## `run_ctrl.launch` 

```xml
<launch>
    <!-- 启动px4ctrl节点 -->
	<node pkg="px4ctrl" type="px4ctrl_node" name="px4ctrl" output="screen">
        	<!-- <remap from="~odom" to="/vicon_imu_ekf_odom" /> -->
			
            <!-- 将 vins_fusion/imu_propagate 映射为 odmo -->
			<remap from="~odom" to="/vins_fusion/imu_propagate" />
        
        <!-- 将 position_cmd 映射为 cmd -->
		<remap from="~cmd" to="/position_cmd" />
        <!-- 载入参数文件 px4ctrl/config/ctrl_param_fpv.yaml -->
        <rosparam command="load" file="$(find px4ctrl)/config/ctrl_param_fpv.yaml" />
	</node>
 
</launch>
```

## `single_run_in_exp.launch`

* 配置飞机id、地图大小、配置订阅的 `odom_topic` 为 `/vins_fusion/imu_propagate`
* 加载文件 `advanced_param_exp.xml`
  * `advanced_param_exp.xml` 启动了 `ego_planner_node` 节点，命名为 `drone_$(arg drone_id)_ego_planner_node`
* 启动 `ego_planner/traj_server` 结点，命名为 `drone_$(arg drone_id)_traj_server`


## `rviz.launch`

可视化
